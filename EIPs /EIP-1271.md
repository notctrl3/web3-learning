## [EIP-1271](https://eips.ethereum.org/EIPS/eip-1271):Standard Signature Validation Method for Contracts

### Motivation                            
 - 传统账户（EOA）靠私钥签名消息
 - 合约钱包 / 多签 / DAO 钱包 / 智能账户 没有私钥，因此需要标准接口，让合约自己声明某个签名是否有效
### Specification
``` solidity
pragma solidity ^0.5.0;

contract ERC1271 {

  // bytes4(keccak256("isValidSignature(bytes32,bytes)")
  bytes4 constant internal MAGICVALUE = 0x1626ba7e;

  /**
   * @dev Should return whether the signature provided is valid for the provided hash
   * @param _hash      Hash of the data to be signed
   * @param _signature Signature byte array associated with _hash
   *
   * MUST return the bytes4 magic value 【0x1626ba7e】 when function passes.
   * MUST NOT modify state (using STATICCALL for solc < 0.5, view modifier for solc > 0.5)
   * MUST allow external calls
   */ 
  function isValidSignature(
    bytes32 _hash, 
    bytes memory _signature)
    public
    view 
    returns (bytes4 magicValue);
}
```
只要`isValidSignature`验证通过,"合约钱包"认可交易
### Security Considerations
#### Gas-limit
调用外部合约的 isValidSignature 没有预设 gas，如果某些实现非常复杂（例如多签聚合验证），可能耗费大量 gas。业务合约调用时不要硬编码 gas，否则可能导致签名验证失败
#### msg.sender
任何人都可以发交易，msg.sender 可能不是 owner,合约钱包必须自己判断签名合法性
### Applicaition
[Gnosis Safe](https://github.com/safe-fndn/safe-smart-account/blob/main/contracts/Safe.sol)
  
