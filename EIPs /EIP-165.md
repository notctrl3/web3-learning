## [EIP-165](https://eips.ethereum.org/EIPS/eip-165): Standard Interface Detection

### Motivation                            
 - 以太坊里有很多“标准接口”：譬如代币 (ERC‑20)、NFT (ERC‑721)、多代币 (ERC‑1155) 等。不同合约可能实现不同标准/接口。 
 - 如果没有统一机制，就得靠“硬编码函数名 + 参数 + ABI 校验”，容易错／不可靠。EIP‑165 提供一种标准化、可靠、通用的方法来检测合约能力。 
 - 对 DApp、合约间交互非常重要 —— 它允许写“通用代码”：先检查对方是否支持某接口，再决定调用哪种逻辑。这样更安全、更动态。
### Specification
 一个合约如果支持 ERC‑165，就必须实现下面这个接口 (通常写成 Solidity 接口)：
```
interface ERC165 {
  function supportsInterface(bytes4 interfaceID) external view returns (bool);
}
```

对应的 interface ID（即 ERC‑165 自己的 ID）是`0x01ffc9a7`。 计算方法例如 bytes4(keccak256("supportsInterface(bytes4)"))。 
合约里`supportsInterface`的实现应满足：
 - 当参数是上面的 ERC‑165 自己的 ID 时，返回 true
 - 当参数是 `0xffffffff（保留值）`时，必须返回 false
 - 对于其它 interface ID，如果合约实现了对应接口 (函数集合)，返回 true，否则 false
 - supportsInterface 调用必须是 view / staticcall，并且 gas 消耗必须 ≤ 30,000 gas（避免调用复杂逻辑/heavy fallback），确保外部合约安全调用/检测
#### 如何检测某合约是否支持某接口
 - 使用 staticcall（或 call） 调用目标合约的 supportsInterface(interfaceId)，传入需要detect的`interface ID` 
 如果返回 true → 说明目标合约宣称（并应该）支持那个接口，你可以安全调用对应接口的方法。
 如果返回 false 或不响应 (revert、call 失败) → 不支持/不安全，需要fallback
### Security Considerations
#### events
ERC‑165 只检测函数 selector，不检测事件、struct、枚举、继承层级等。如果接口依赖事件/复杂逻辑，仅凭 ERC‑165 不够。 
#### EOA (externally owned accounts)
ERC‑165 只对合约有意义
### Application
[OpenZeppelin ERC721.sol](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/ERC721.sol)
